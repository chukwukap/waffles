import { useId } from "react";
import { SoundOffIcon, SoundOnIcon } from "@/components/icons";
import { formatTimeColon } from "@/lib/utils";
import { useSound } from "@/hooks/useSound";
import Image from "next/image";

export function QuestionCardHeader({
  questionNumber,
  totalQuestions,
  remaining,
  duration,
}: {
  questionNumber: number;
  totalQuestions: number;
  remaining: number;
  duration: number;
}) {
  const { soundEnabled, toggleSound } = useSound();
  const clipPathId = useId();

  return (
    <div className="w-full flex items-center justify-between px-3 py-2 ">
      {/* Question Counter */}
      <span className="font-body text-white text-[18px] leading-none tracking-tight">
        {String(questionNumber).padStart(2, "0")}/
        {String(totalQuestions).padStart(2, "0")}
      </span>

      {/* Sound Toggle Button */}
      <button
        onClick={toggleSound}
        aria-label={soundEnabled ? "Mute sound" : "Unmute sound"}
        type="button"
        className="
          mr-auto ml-3 flex items-center justify-center
          w-[34px] h-[34px]
          gap-2
          rounded-full
          p-2
          bg-white/10
          backdrop-blur-sm
          transition-transform
          active:scale-95
        "
        style={{
          borderImage:
            "linear-gradient(180deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.1) 100%) 1",
        }}
      >
        {soundEnabled ? (
          <SoundOffIcon className="w-4 h-4 text-white" />
        ) : (
          <SoundOnIcon className="w-4 h-4 text-white" />
        )}
      </button>

      {/* Timer Logic */}
      {remaining > 3 ? (
        <div className="flex items-center">
          <svg
            width="78"
            height="12"
            viewBox="0 0 78 12"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <defs>
              <clipPath id={`timer-clip-${clipPathId}`}>
                <rect
                  x="0"
                  y="0"
                  width={
                    duration > 3
                      ? 78 *
                        (1 -
                          Math.min(
                            100,
                            Math.max(
                              0,
                              ((duration - remaining) / (duration - 3)) * 100
                            )
                          ) /
                            100)
                      : 0
                  }
                  height="12"
                />
              </clipPath>
            </defs>
            {/* Background for unfilled part */}
            <rect
              x="0"
              y="0"
              width="78"
              height="12"
              rx="6"
              ry="6"
              fill="#E9DCCB"
            />
            <g clipPath={`url(#timer-clip-${clipPathId})`}>
              <path
                d="M4.65347 0.0181034C4.67876 0.0181034 12.9951 0.0135697 24.3842 0.00904481V0C29.2189 0 34.1801 0.00452931 38.9979 0.00452931C43.8242 0.00452931 48.7811 0 53.6158 0V0.00904481C65.0049 0.0135697 73.3213 0.0181034 73.3466 0.0181034C75.9178 0.0181034 78 2.69684 78 6.00001C78 9.3077 75.9178 11.9864 73.3466 11.9864C73.3213 11.9864 65.0049 11.9864 53.6158 11.991V12C48.7811 12 43.8242 11.9955 38.9979 11.9955C34.1801 11.9955 29.2189 12 24.3842 12V11.991C12.9951 11.9864 4.67876 11.9864 4.65347 11.9864C2.08227 11.9864 0 9.3077 0 6.00001C0 2.69684 2.08227 0.0181034 4.65347 0.0181034Z"
                fill="#BE3C2B"
              />
              <path
                d="M5.07078 0.271509C5.09185 0.271509 13.307 0.266979 24.5571 0.266979V0.257935C29.3328 0.257935 34.2307 0.257939 38.9937 0.262464C43.761 0.257939 48.6589 0.257935 53.4346 0.257935V0.266979C64.6846 0.266979 72.8998 0.271509 72.9209 0.271509C75.4626 0.271509 77.5195 2.65612 77.5195 5.5973C77.5195 8.53848 75.4626 10.9186 72.9209 10.9186C72.8998 10.9186 64.6846 10.9231 53.4346 10.9276V10.9367C48.6589 10.9322 43.761 10.9321 38.9937 10.9276C34.2307 10.9321 29.3328 10.9322 24.5571 10.9367V10.9276C13.307 10.9231 5.09185 10.9186 5.07078 10.9186C2.5333 10.9186 0.472115 8.53848 0.472115 5.5973C0.472115 2.65612 2.5333 0.271509 5.07078 0.271509Z"
                fill="#F96F49"
              />
              <path
                d="M5.91797 1.0453C5.93905 1.0453 13.935 1.04531 24.8858 1.04078V1.03625C29.535 1.03625 34.3065 1.03626 38.9431 1.04078C43.5797 1.03626 48.3469 1.03625 52.9961 1.03625V1.04078C63.9469 1.04531 71.9471 1.0453 71.9682 1.0453C74.4382 1.0453 76.4404 3.0815 76.4404 5.59734C76.4404 8.10865 74.4382 10.1449 71.9682 10.1449C71.9471 10.1449 63.9469 10.1448 52.9961 10.1494V10.1539C48.3469 10.1539 43.5797 10.1539 38.9431 10.1539C34.3065 10.1539 29.535 10.1539 24.8858 10.1539V10.1494C13.935 10.1448 5.93905 10.1449 5.91797 10.1449C3.44794 10.1449 1.44154 8.10865 1.44154 5.59734C1.44154 3.0815 3.44794 1.0453 5.91797 1.0453Z"
                fill="#F96F49"
              />
              <path
                d="M5.91797 1.0453C5.93905 1.0453 13.935 1.04531 24.8858 1.04078V1.03625C29.535 1.03625 34.3065 1.03626 38.9431 1.04078C43.5797 1.03626 48.3469 1.03625 52.9961 1.03625V1.04078C63.9469 1.04531 71.9471 1.0453 71.9682 1.0453C74.4382 1.0453 76.4404 3.0815 76.4404 5.59734C76.4404 8.10865 74.4382 10.1449 71.9682 10.1449C71.9471 10.1449 63.9469 10.1448 52.9961 10.1494V10.1539C48.3469 10.1539 43.5797 10.1539 38.9431 10.1539C34.3065 10.1539 29.535 10.1539 24.8858 10.1539V10.1494C13.935 10.1448 5.93905 10.1449 5.91797 10.1449C3.44794 10.1449 1.44154 8.10865 1.44154 5.59734C1.44154 3.0815 3.44794 1.0453 5.91797 1.0453Z"
                fill="#F96F49"
              />
              <path
                d="M51.4162 0.990967V10.1352C48.6511 10.1352 45.8607 10.1352 43.083 10.1352V0.990967C45.8607 0.990967 48.6511 0.990967 51.4162 0.990967Z"
                fill="#F96F49"
              />
              <path
                d="M38.914 0.996029C40.2966 0.992658 41.6862 0.990967 43.0828 0.990967V10.1352C41.6862 10.1352 40.2966 10.1352 38.914 10.1352C37.5343 10.1352 36.1461 10.1352 34.7495 10.1352V0.990967C36.1461 0.990967 37.5343 0.992658 38.914 0.996029Z"
                fill="#F96F49"
              />
              <path
                d="M52.9714 0.990967V0.996029C55.3951 0.996029 57.6712 1.00108 59.7493 1.00108V10.1302C57.6712 10.1302 55.3951 10.1302 52.9714 10.1302V10.1403C52.4544 10.1403 51.9359 10.1386 51.4161 10.1352V0.990967C51.9359 0.990967 52.4544 0.990967 52.9714 0.990967Z"
                fill="#F96F49"
              />
              <path
                d="M18.0834 1.00079V10.1299C14.6987 10.1299 11.8451 10.1248 9.75016 10.1248V1.00079C11.8451 1.00079 14.6987 1.00079 18.0834 1.00079Z"
                fill="#F96F49"
              />
              <path
                d="M34.7498 0.990967V10.1352C31.972 10.1352 29.1816 10.1352 26.4165 10.1352V0.990967C29.1816 0.990967 31.972 0.990967 34.7498 0.990967Z"
                fill="#F96F49"
              />
              <path
                d="M5.89307 1.00079C5.9015 1.00079 7.31356 1.00079 9.74988 1.00079V10.1248C7.31356 10.1248 5.9015 10.1248 5.89307 10.1248C3.42304 10.1248 1.41666 8.08154 1.41666 5.56282C1.41666 3.0441 3.42304 1.00079 5.89307 1.00079Z"
                fill="#F96F49"
              />
              <path
                d="M24.861 0.996029V0.990967C25.378 0.990967 25.8965 0.990967 26.4163 0.990967V10.1352C25.8965 10.1386 25.378 10.1403 24.861 10.1403V10.1302C22.4373 10.1302 20.1612 10.1302 18.0831 10.1302V1.00108C20.1612 1.00108 22.4373 0.996029 24.861 0.996029Z"
                fill="#F96F49"
              />
              <g style={{ mixBlendMode: "color-dodge", opacity: 0.8 }}>
                <path
                  d="M7.36799 2.04066C7.38906 2.04066 15.0479 2.04066 25.5392 2.04066V2.03613C29.9903 2.03613 34.5595 2.03613 38.9979 2.03613C43.4406 2.03613 48.0098 2.03613 52.4651 2.03613V2.04066C62.9522 2.04066 70.611 2.04066 70.6321 2.04066C73.001 2.04066 74.9188 3.07234 74.9188 4.34383C74.9188 5.61532 73.001 6.647 70.6321 6.647C70.611 6.647 62.9522 6.647 52.4651 6.647V6.65152C48.0098 6.65152 43.4406 6.65152 38.9979 6.65152C34.5595 6.65152 29.9903 6.65152 25.5392 6.65152V6.647C15.0479 6.647 7.38906 6.647 7.36799 6.647C4.99911 6.647 3.08126 5.61532 3.08126 4.34383C3.08126 3.07234 4.99911 2.04066 7.36799 2.04066Z"
                  fill="#F96F49"
                />
              </g>
              <g style={{ mixBlendMode: "color-dodge", opacity: 0.5 }}>
                <path
                  d="M9.7453 2.82349C9.76637 2.82349 16.9025 2.82349 26.6688 2.82349C30.8165 2.82349 35.0695 2.82349 39.2087 2.82349C43.3437 2.82349 47.6009 2.82349 51.7443 2.82349C61.5149 2.82349 68.651 2.82349 68.6679 2.82349C70.8724 2.82349 72.6595 3.17644 72.6595 3.61083C72.6595 4.04069 70.8724 4.39362 68.6679 4.39362C68.651 4.39362 61.5149 4.39362 51.7443 4.39362C47.6009 4.39362 43.3437 4.39362 39.2087 4.39362C35.0695 4.39362 30.8165 4.39362 26.6688 4.39362C16.9025 4.39362 9.76637 4.39362 9.7453 4.39362C7.54503 4.39362 5.75363 4.04069 5.75363 3.61083C5.75363 3.17644 7.54503 2.82349 9.7453 2.82349Z"
                  fill="#F96F49"
                />
              </g>
            </g>
          </svg>
        </div>
      ) : (
        <div className="flex items-center gap-1">
          <Image
            src="/images/icons/clock.svg"
            width={30}
            height={30}
            priority={true}
            alt="clock"
            className="w-[30px] h-[30px]"
          />
          <span className="text-[#B93814] text-2xl">
            {formatTimeColon(remaining)}
          </span>
        </div>
      )}
    </div>
  );
}
